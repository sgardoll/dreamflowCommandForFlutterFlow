<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Code Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dart.min.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap");

      * { box-sizing: border-box; }
      
      body {
        font-family: "Inter", sans-serif;
        background: #0a0a0b;
        color: #fafafa;
      }

      .code-font { font-family: "JetBrains Mono", monospace; }

      /* Code block with copy button */
      .code-container {
        position: relative;
        background: #111113;
        border: 1px solid #27272a;
        border-radius: 8px;
        margin-top: 12px;
      }
      
      .code-container pre {
        margin: 0;
        padding: 16px;
        overflow: auto;
        max-height: 400px;
        font-size: 13px;
        line-height: 1.6;
      }

      .copy-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #27272a;
        border: 1px solid #3f3f46;
        color: #a1a1aa;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      
      .copy-btn:hover {
        background: #3f3f46;
        color: #fff;
      }
      
      .copy-btn.copied {
        background: #22c55e;
        border-color: #22c55e;
        color: #fff;
      }

      /* Step cards */
      .step-card {
        background: #18181b;
        border: 1px solid #27272a;
        border-radius: 12px;
        overflow: hidden;
      }

      .step-header {
        padding: 16px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        transition: background 0.15s;
      }
      
      .step-header:hover { background: #1f1f23; }

      .step-badge {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: #27272a;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.2s;
      }
      
      .step-badge.active { background: #6366f1; }
      .step-badge.done { background: #22c55e; }
      .step-badge.error { background: #ef4444; }

      .step-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }
      
      .step-content.open {
        max-height: 2000px;
      }

      .step-body {
        padding: 0 20px 20px;
      }

      /* Spinner */
      .spinner {
        width: 24px;
        height: 24px;
        border: 2px solid #27272a;
        border-top-color: #6366f1;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      
      @keyframes spin { to { transform: rotate(360deg); } }

      /* Input area */
      textarea {
        background: #111113;
        border: 1px solid #27272a;
        border-radius: 8px;
        resize: none;
        transition: border-color 0.15s;
      }
      
      textarea:focus {
        outline: none;
        border-color: #6366f1;
      }

      /* Button */
      .btn-primary {
        background: #6366f1;
        color: white;
        font-weight: 600;
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: background 0.15s;
      }
      
      .btn-primary:hover { background: #5558e3; }
      .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

      /* Select */
      select {
        background: #18181b;
        border: 1px solid #27272a;
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
      }
      
      select:focus { outline: none; border-color: #6366f1; }

      /* Syntax highlighting */
      .hljs { background: transparent !important; }
      .hljs-keyword { color: #c084fc !important; }
      .hljs-string { color: #86efac !important; }
      .hljs-number { color: #fbbf24 !important; }
      .hljs-comment { color: #6b7280 !important; font-style: italic; }
      .hljs-type, .hljs-built_in { color: #a78bfa !important; }
      .hljs-class .hljs-title { color: #34d399 !important; }

      /* Audit result styling */
      .audit-section { margin-bottom: 16px; }
      .audit-section h3 { font-size: 14px; font-weight: 600; margin-bottom: 8px; }
      .audit-item { padding: 8px 12px; background: #111113; border-radius: 6px; margin-bottom: 6px; font-size: 13px; }
    </style>
  </head>
  <body class="min-h-screen">
    <!-- Header -->
    <header class="border-b border-zinc-800 px-6 py-5">
      <div class="max-w-3xl mx-auto flex items-center justify-center gap-3">
        <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
          </svg>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-xs font-bold tracking-wider text-indigo-400">FLUTTERFLOW</span>
          <span class="font-semibold text-lg">Custom Code Command</span>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="max-w-3xl mx-auto px-6 py-8">
      <!-- Input Section -->
      <div class="mb-8">
        <textarea
          id="pipeline-input"
          class="w-full h-28 p-4 code-font text-sm text-zinc-300 placeholder-zinc-600"
          placeholder="Describe your FlutterFlow widget..."
        ></textarea>
        
        <div class="flex items-center justify-between mt-4 gap-4">
          <div class="flex items-center gap-3">
            <label class="text-sm text-zinc-500">Model:</label>
            <select id="code-generator-model">
              <option value="gemini-3.0-pro">Gemini 3.0 Pro</option>
              <option value="claude-4.5-opus">Claude 4.5 Opus</option>
              <option value="gpt-5.2-codex">GPT-5.2-Codex</option>
            </select>
          </div>
          <button id="btn-run-pipeline" class="btn-primary" onclick="runThinkingPipeline()">
            Generate
          </button>
        </div>
      </div>

      <!-- Pipeline Steps -->
      <div class="space-y-4">
        <!-- Step 1: Prompt Architect -->
        <div class="step-card">
          <div class="step-header" onclick="toggleStep('step1')">
            <div class="flex items-center gap-3">
              <div id="step1-indicator" class="step-badge">1</div>
              <div>
                <div class="font-medium">Prompt Architect</div>
                <div class="text-xs text-zinc-500">Optimizes your request for code generation</div>
              </div>
            </div>
            <svg id="step1-chevron" class="w-5 h-5 text-zinc-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
          <div id="step1-content" class="step-content">
            <div class="step-body">
              <div id="step1-loading" class="hidden py-8 flex justify-center">
                <div class="spinner"></div>
              </div>
              <div id="step1-result" class="hidden">
                <div class="code-container">
                  <button class="copy-btn" onclick="copyCode('step1-output')">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    Copy
                  </button>
                  <pre id="step1-output" class="code-font text-zinc-300"></pre>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Code Generator -->
        <div class="step-card">
          <div class="step-header" onclick="toggleStep('step2')">
            <div class="flex items-center gap-3">
              <div id="step2-indicator" class="step-badge">2</div>
              <div>
                <div class="font-medium">Code Generator</div>
                <div id="step2-model-info" class="text-xs text-zinc-500">Generates FlutterFlow-compatible Dart code</div>
              </div>
            </div>
            <svg id="step2-chevron" class="w-5 h-5 text-zinc-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
          <div id="step2-content" class="step-content">
            <div class="step-body">
              <div id="step2-loading" class="hidden py-8 flex justify-center">
                <div class="spinner"></div>
              </div>
              <div id="step2-result" class="hidden">
                <div class="code-container">
                  <button class="copy-btn" onclick="copyCode('step2-output')">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    Copy
                  </button>
                  <pre id="step2-output" class="code-font text-zinc-300"></pre>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Code Audit -->
        <div class="step-card">
          <div class="step-header" onclick="toggleStep('step3')">
            <div class="flex items-center gap-3">
              <div id="step3-indicator" class="step-badge">3</div>
              <div>
                <div class="font-medium">Code Audit</div>
                <div class="text-xs text-zinc-500">Validates FlutterFlow compatibility</div>
              </div>
            </div>
            <svg id="step3-chevron" class="w-5 h-5 text-zinc-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
          <div id="step3-content" class="step-content">
            <div class="step-body">
              <div id="step3-loading" class="hidden py-8 flex justify-center">
                <div class="spinner"></div>
              </div>
              <div id="step3-result" class="hidden">
                <div id="step3-output" class="text-sm text-zinc-300"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>
